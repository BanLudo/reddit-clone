<div class="edit-post-container">
	@if(loading()){
	<div class="loading-container">
		<mat-spinner></mat-spinner>
	</div>
	}@else {
	<mat-card class="edit-post-card">
		<mat-card-header>
			<mat-card-title>Modifier le post</mat-card-title>
		</mat-card-header>

		<mat-card-content>
			<form [formGroup]="postForm" (ngSubmit)="onSubmit()">
				<mat-form-field appearance="outline" class="full-width">
					<mat-label>Titre</mat-label>
					<input matInput formControlName="title" maxlength="300" required />
					@if(postForm.get('title')?.hasError('required') && postForm.get('title')?.touched){
					<mat-error>Le titre est requis</mat-error>
					}
					<mat-hint>{{ postForm.get("title")?.value?.length || 0 }}/300</mat-hint>
				</mat-form-field>

				<mat-form-field appearance="outline" class="full-width">
					<mat-label>Contenu (optionel)</mat-label>
					<textarea
						matInput
						formControlName="content"
						rows="6"
						placeholder="Decrivez votre post..."></textarea>
				</mat-form-field>

				<div class="image-upload-section">
					<input
						type="file"
						#fileInput
						(change)="onFileSelected($event)"
						accept="image/*"
						style="display: none" />

					<button
						mat-button
						type="button"
						(click)="fileInput.click()"
						[disabled]="uploadingImage()">
						<mat-icon>image</mat-icon>
						@if(uploadingImage()){ Téléchargement... }@else { Changer l'image }
					</button>

					@if(uploadingImage()){
					<mat-spinner diameter="20"></mat-spinner>
					} @if(selectedImageUrl()){
					<div class="image-preview">
						<img src="selectedImageUrl()" alt="Preview" />
						<button mat-icon-button type="button" (click)="removeImage()">
							<mat-icon>Close</mat-icon>
						</button>
					</div>
					}
				</div>

				<div class="form-actions">
					<button mat-button [routerLink]="['/post', postId()]" type="button">Annuler</button>
					<button
						mat-raised-button
						color="primary"
						type="submit"
						[disabled]="postForm.invalid || savingPost()">
						@if(savingPost()){
						<mat-spinner diameter="16"></mat-spinner>
						}@else { Enregistrer }
					</button>
				</div>
			</form>
		</mat-card-content>
	</mat-card>
	}
</div>
