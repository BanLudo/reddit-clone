<div class="profile-container">
	@if (loading()) {
	<div class="loading-container">
		<mat-spinner></mat-spinner>
	</div>
	}@else if (currentUser()) {
	<mat-card class="profile-card">
		<mat-card-content>
			<div class="profile-header">
				<div class="avatar-section">
					@if (currentUser()!.imageUrl) {
					<img
						[src]="currentUser()!.imageUrl"
						[alt]="currentUser()!.username"
						class="profile-avatar" />
					}@else {
					<div class="default-avatar">
						<mat-icon>account_circle</mat-icon>
					</div>
					}
				</div>

				<div class="profile-info">
					<h1>{{ currentUser()!.username }}</h1>
					<p class="email">{{ currentUser()!.email }}</p>
					<p class="join-date">Membre depuis {{ formatDate(currentUser()!.createdAt) }}</p>

					<div class="stats">
						<div class="stat-item">
							<span class="stat-value">{{ currentUser()!.postCount || 0 }}</span>
							<span class="stat-label">Posts</span>
						</div>

						<mat-divider [vertical]="true"></mat-divider>

						<div class="stat-item">
							<span class="stat-value">{{ currentUser()!.commentCount || 0 }}</span>
							<span class="stat-label">Commentaires</span>
						</div>
					</div>
				</div>

				<div class="profile-actions">
					<button mat-raised-button color="primary">
						<mat-icon>edit</mat-icon>
						Modifier le profil
					</button>
				</div>
			</div>
		</mat-card-content>
	</mat-card>

	<mat-card class="content-card">
		<mat-tab-group (selectedTabChange)="onTabChange($event)">
			<!-- TAB 1 : mes posts -->
			<mat-tab label="Mes posts">
				<div class="tab-content">
					@if (loadingPosts()) {
					<div class="loading-container">
						<mat-spinner diameter="40"></mat-spinner>
					</div>
					}@else if (userPosts().length === 0) {
					<div class="empty-state">
						<mat-icon>post_add</mat-icon>
						<h3>Aucun post publi√©</h3>
						<p>Vous n'avez encore publi√© aucun post.</p>
						<button mat-raised-button color="primary" routerLink="/create-post">
							Cr√©er votre premier post
						</button>
					</div>
					}@else { @for (post of userPosts(); track post.id) {
					<app-post-card [post]="post" [canDo]="true"></app-post-card>
					} @if (hasMorePosts()) {
					<div class="load-more">
						<button
							mat-button
							color="primary"
							(click)="loadMorePosts()"
							[disabled]="loadingPosts()">
							@if (loadingPosts()) {
							<mat-spinner diameter="20"></mat-spinner>
							}@else { Charger plus }
						</button>
					</div>
					} }
				</div>
			</mat-tab>
			<!-- TAB 2 : mes commentaires -->
			<mat-tab label="Mes Commentaires">
				<div class="tab-content">
					@if(loadingComments()){
					<div class="loading-container">
						<mat-spinner diameter="40"></mat-spinner>
					</div>
					}@else if (userComments().length ===0) {
					<div class="empty-state">
						<mat-icon>comment</mat-icon>
						<h3>Aucun commentaire</h3>
						<p>Vous n'avez encore post√© aucun commentaire.</p>
					</div>
					}@else {
					<div class="comments-list">
						@for (comment of userComments(); track comment.id) {
						<mat-card class="comment-card">
							<mat-card-content>
								<div class="comment-header">
									<span class="post-link" [routerLink]="['/post', comment.postId]">
										{{ comment.postTitle }}
									</span>
									<span class="comment-date">{{ getRelativeTime(comment.createdAt) }}</span>
								</div>
								<div class="comment-content">{{ comment.content }}</div>
								<div class="comment-footer">
									<span
										class="vote-info"
										[class.positive]="comment.voteCount > 0"
										[class.negative]="comment.voteCount < 0">
										<mat-icon>arrow_upward</mat-icon>
										{{ comment.voteCount }} points
									</span>
									<button mat-button color="primary" [routerLink]="['/post', comment.postId]">
										Voir le post
									</button>
								</div>
							</mat-card-content>
						</mat-card>
						} @if (hasMoreComments()) {
						<div class="load-more">
							<button
								mat-button
								color="primary"
								(click)="loadMoreComment()"
								[disabled]="loadingComments()">
								@if (loadingComments()) {
								<mat-spinner diameter="20"></mat-spinner>
								}@else { Charger plus }
							</button>
						</div>
						}
					</div>
					}
				</div>
			</mat-tab>

			<!-- TAB 3 : Post sauvegard√©s -->
			<mat-tab label="Posts sauvegard√©s">
				<div class="tab-content">
					<div class="empty-state">
						<mat-icon>bookmark</mat-icon>
						<h3>Fonctionnalit√© √† venir</h3>
						<p>Les posts que vous sauvegardez appara√™trong ici.</p>
						<p class="info-text">
							üí° Pour impl√©menter cette fonctionnalit√©, il faudrait :
							<br />
							1. Ajouter une table "saved_posts" dans la base de donn√©es
							<br />
							2. Cr√©er les endpoints backend pour sauvegarder/r√©cup√©rer
							<br />
							3. Ajouter un bouton "Sauvegarder" sur chaque post
						</p>
					</div>
				</div>
			</mat-tab>
		</mat-tab-group>
	</mat-card>
	}
</div>
